// 1. Replace all "Demo" texts with "Real" and style parent node instead of using new span
function replaceAndStyleText(node) {
  if (node.nodeType === 3 && /Demo/i.test(node.textContent)) {
    // Replace text content
    node.textContent = node.textContent.replace(/Demo/gi, "Real");

    // Style parent element
    const parent = node.parentNode;
    parent.style.backgroundColor = "rgba(255, 235, 59, 0.15)";
    parent.style.color = "#f9d84f";  // ← হালকা হলুদ রঙ
    parent.style.fontWeight = "300"; // হালকা চিকন (lighter)
    parent.style.borderRadius = "2px"; // ← একদম হালকা গোল কোণা
    parent.style.padding = "3px 8px";
    parent.style.display = "inline-block";
    parent.style.fontSize = "13px";
    parent.style.lineHeight = "1";
  } else if (node.nodeType === 1 && node.childNodes.length > 0) {
    node.childNodes.forEach(replaceAndStyleText);
  }
}

// 2. Replace "Top Up" button with "Withdraw" & "Deposit" buttons
function replaceTopUpWithButtons() {
  const buttons = Array.from(document.querySelectorAll("button,div"))
    .filter(el =>
      el.childNodes.length === 1 &&
      el.textContent.trim() === "Top Up"
    );

  buttons.forEach(topUpBtn => {
    const btnRow = document.createElement("div");
    btnRow.style.display = "flex";
    btnRow.style.gap = "6px";
    btnRow.style.margin = "16px 8px 10px 8px";
    btnRow.style.justifyContent = "center";
    btnRow.style.width = "calc(100% - 16px)";

    const btnBg = "rgba(255,255,255,0.17)";
    const btnBgHover = "rgba(255,255,255,0.26)";

    const withdrawBtn = document.createElement("button");
    withdrawBtn.textContent = "Withdraw";
    withdrawBtn.style.background = btnBg;
    withdrawBtn.style.color = "#fff";
    withdrawBtn.style.border = "none";
    withdrawBtn.style.borderRadius = "4px";
    withdrawBtn.style.padding = "7px 0";
    withdrawBtn.style.fontWeight = "500";
    withdrawBtn.style.cursor = "pointer";
    withdrawBtn.style.fontSize = "15px";
    withdrawBtn.style.flex = "1 1 0";
    withdrawBtn.style.transition = "background 0.15s";
    withdrawBtn.style.marginLeft = "4px";
    withdrawBtn.style.marginRight = "0px";
    withdrawBtn.onmouseenter = () => withdrawBtn.style.background = btnBgHover;
    withdrawBtn.onmouseleave = () => withdrawBtn.style.background = btnBg;

    const depositBtn = document.createElement("button");
    depositBtn.textContent = "Deposit";
    depositBtn.style.background = btnBg;
    depositBtn.style.color = "#fff";
    depositBtn.style.border = "none";
    depositBtn.style.borderRadius = "4px";
    depositBtn.style.padding = "7px 0";
    depositBtn.style.fontWeight = "500";
    depositBtn.style.cursor = "pointer";
    depositBtn.style.fontSize = "15px";
    depositBtn.style.flex = "1 1 0";
    depositBtn.style.transition = "background 0.15s";
    depositBtn.style.marginLeft = "0px";
    depositBtn.style.marginRight = "4px";
    depositBtn.onmouseenter = () => depositBtn.style.background = btnBgHover;
    depositBtn.onmouseleave = () => depositBtn.style.background = btnBg;

    btnRow.appendChild(withdrawBtn);
    btnRow.appendChild(depositBtn);

    topUpBtn.parentNode.replaceChild(btnRow, topUpBtn);
  });
}

// 3. Observe DOM for changes (for dynamic pages like DOM 11)
const observer = new MutationObserver(() => {
  replaceTopUpWithButtons();
  replaceAndStyleText(document.body);
});

observer.observe(document.body, {
  childList: true,
  subtree: true,
});

// 4. Initial run
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", () => {
    replaceTopUpWithButtons();
    replaceAndStyleText(document.body);
  });
} else {
  replaceTopUpWithButtons();
  replaceAndStyleText(document.body);
}

// 5. License check logic (Unchanged)
(async function runLicenseCheck() {
  const waitForDOM = () =>
    new Promise((res) => {
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", res);
      } else {
        res();
      }
    });

  const loadScript = (src) =>
    new Promise((res) => {
      if (document.querySelector(`script[src="${src}"]`)) return res();
      const s = document.createElement("script");
      s.src = src;
      s.onload = res;
      document.head.appendChild(s);
    });

  if (typeof cancelBtn !== "undefined" && typeof modalBackdrop !== "undefined")
    cancelBtn.onclick = () => {
      modalBackdrop.remove();
    };

  if (typeof inputEl !== "undefined") inputEl.focus();
})();
